import{m as f,_ as v,o as r,b as u,d as t,t as p,j as n,l as c,u as U,f as g,r as _,e as b,F as M,k as V}from"./index-CgHBEOTy.js";import{s as P}from"./sweetAlertStore-w7mpYN6A.js";import{m as x}from"./modalMixin-oCo5jlFQ.js";import{P as T}from"./PaginationCard-WepPkMZT.js";var C={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_NAME:"eatburgertest",BASE_URL:"/EatBurger/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:L,VITE_NAME:D}=C,N={props:{tempProduct:{},updateProduct:{},isNew:{}},data(){return{modal:null,editProduct:{}}},methods:{...f(P,["errorToast"]),uploadFile(){const l=this.$refs.fileInput.files[0],e=new FormData;e.append("file-to-upload",l),this.$http.post(`${L}/v2/api/${D}/admin/upload`,e,{headers:{"Content-Type":"multipart/form-data"}}).then(a=>{this.editProduct.imageUrl=a.data.imageUrl}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})}},watch:{tempProduct(){this.editProduct=this.tempProduct,this.$refs.fileInput.value=""}},emits:["update-product"],mixins:[x]},I={id:"productModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},R={class:"modal-dialog modal-xl"},S={class:"modal-content border-0"},A={class:"modal-header bg-dark text-white"},F={id:"productModalLabel",class:"modal-title fs-4"},B=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-body"},j={class:"row"},q={class:"col-sm-4"},z={class:"mb-2"},G=t("label",{for:"imageUrl",class:"form-label"},"商品画像",-1),H=["src"],J=t("label",{for:"customFile",class:"form-label"},"画像選択",-1),K={class:"col-sm-8"},Q={class:"mb-3"},W=t("label",{for:"title",class:"form-label"},"商品名",-1),X={class:"row"},Y={class:"mb-3 col-md-6"},Z=t("label",{for:"category",class:"form-label"},"分類",-1),tt={class:"mb-3 col-md-6"},et=t("label",{for:"unit",class:"form-label"},"ユニット",-1),st={class:"row"},ot={class:"mb-3 col-md-6"},lt=t("label",{for:"origin_price",class:"form-label"},"原価",-1),dt={class:"mb-3 col-md-6"},it=t("label",{for:"price",class:"form-label"},"販売価格",-1),at=t("hr",null,null,-1),nt={class:"mb-3"},ct=t("label",{for:"description",class:"form-label"},"概要",-1),rt={class:"mb-3"},ut={class:"form-check"},pt=t("label",{class:"form-check-label",for:"is_enabled"},"アクティベート",-1),mt={class:"modal-footer"},ht=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," キャンセル ",-1);function _t(l,e,a,$,s,i){return r(),u("div",I,[t("div",R,[t("div",S,[t("div",A,[t("h2",F,p(a.isNew?"新規作成":"商品編集"),1),B]),t("div",O,[t("div",j,[t("div",q,[t("div",z,[G,n(t("input",{type:"text",class:"form-control mb-2",placeholder:"画像URL","onUpdate:modelValue":e[0]||(e[0]=o=>s.editProduct.imageUrl=o),disabled:""},null,512),[[c,s.editProduct.imageUrl]]),t("img",{class:"img-fluid",src:s.editProduct.imageUrl,alt:""},null,8,H)]),t("div",null,[J,t("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInput",onChange:e[1]||(e[1]=(...o)=>i.uploadFile&&i.uploadFile(...o))},null,544)])]),t("div",K,[t("div",Q,[W,n(t("input",{id:"title",type:"text",class:"form-control",placeholder:"商品名","onUpdate:modelValue":e[2]||(e[2]=o=>s.editProduct.title=o)},null,512),[[c,s.editProduct.title]])]),t("div",X,[t("div",Y,[Z,n(t("input",{id:"category",type:"text",class:"form-control",placeholder:"分類","onUpdate:modelValue":e[3]||(e[3]=o=>s.editProduct.category=o)},null,512),[[c,s.editProduct.category]])]),t("div",tt,[et,n(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"ユニット","onUpdate:modelValue":e[4]||(e[4]=o=>s.editProduct.unit=o)},null,512),[[c,s.editProduct.unit]])])]),t("div",st,[t("div",ot,[lt,n(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"原価","onUpdate:modelValue":e[5]||(e[5]=o=>s.editProduct.origin_price=o)},null,512),[[c,s.editProduct.origin_price]])]),t("div",dt,[it,n(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"販売価格","onUpdate:modelValue":e[6]||(e[6]=o=>s.editProduct.price=o)},null,512),[[c,s.editProduct.price]])])]),at,t("div",nt,[ct,n(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"概要","onUpdate:modelValue":e[7]||(e[7]=o=>s.editProduct.description=o)},`
                `,512),[[c,s.editProduct.description]])]),t("div",rt,[t("div",ut,[n(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[8]||(e[8]=o=>s.editProduct.is_enabled=o)},null,512),[[U,s.editProduct.is_enabled]]),pt])])])])]),t("div",mt,[ht,t("button",{type:"button",class:"btn btn-primary",onClick:e[9]||(e[9]=o=>l.$emit("update-product",s.editProduct))},p(a.isNew?"作成":"保存"),1)])])])],512)}const bt=v(N,[["render",_t]]),ft={props:{tempProduct:{}},data(){return{modal:null}},emits:["delete-product"],mixins:[x]},Pt={id:"delProductModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},gt={class:"modal-dialog"},vt={class:"modal-content border-0"},$t=t("div",{class:"modal-header bg-danger text-white"},[t("h2",{id:"delProductModalLabel",class:"modal-title fs-4"}," 商品削除 "),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),yt={class:"modal-body text-start"},Mt={class:"text-danger"},xt={class:"modal-footer"},wt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," キャンセル ",-1);function Et(l,e,a,$,s,i){return r(),u("div",Pt,[t("div",gt,[t("div",vt,[$t,t("div",yt,[g(" 商品 "),t("span",Mt,p(a.tempProduct.title),1),g(" を削除しますか ")]),t("div",xt,[wt,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=o=>l.$emit("delete-product"))}," 削除 ")])])])],512)}const kt=v(ft,[["render",Et]]);var Ut={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_NAME:"eatburgertest",BASE_URL:"/EatBurger/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:m,VITE_NAME:h}=Ut,Vt={data(){return{isLoading:!1,products:[],pages:{},isNew:!1,tempProduct:{}}},methods:{...f(P,["swalError"]),...f(P,["successToast"]),...f(P,["errorToast"]),getProducts(l=1){this.isLoading=!0,this.$http.get(`${m}/v2/api/${h}/admin/products?page=${l}`).then(e=>{this.products=e.data.products,this.pages=e.data.pagination,this.isLoading=!1}).catch(()=>{this.swalError()})},openModal(l,e){l==="new"?(this.isNew=!0,this.tempProduct={imagesUrl:[""]},this.$refs.pModal.openModal()):l==="edit"?(this.isNew=!1,this.tempProduct={...e},this.$refs.pModal.openModal()):l==="del"&&(this.tempProduct={...e},this.$refs.dModal.openModal())},updateProduct(){let l="post",e="商品データが作成されました",a=`${m}/v2/api/${h}/admin/product`;this.isNew===!1&&(l="put",e="アップデートしました",a=`${m}/v2/api/${h}/admin/product/${this.tempProduct.id}`),this.$http[l](a,{data:this.tempProduct}).then(()=>{this.$refs.pModal.hideModal(),this.getProducts(),this.successToast(e)}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},deleteProduct(){this.$http.delete(`${m}/v2/api/${h}/admin/product/${this.tempProduct.id}`,{data:this.tempProduct}).then(()=>{this.$refs.dModal.hideModal(),this.getProducts(),this.successToast("データが削除されました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},changeIsEnabled(l){this.tempProduct={...l},this.tempProduct.is_enabled=!l.is_enabled,this.$http.put(`${m}/v2/api/${h}/admin/product/${this.tempProduct.id}`,{data:this.tempProduct}).then(()=>{this.getProducts(),this.tempProduct.is_enabled===!0?this.successToast("商品がアクティベートされました"):this.successToast("商品がインアクティブされました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})}},mounted(){this.getProducts()},components:{PaginationCard:T,ProductsModal:bt,DelProductModal:kt}},Tt={class:"container p-3"},Ct=t("h2",{class:"mb-2"},"商品管理",-1),Lt={class:"text-end mt-4"},Dt=t("i",{class:"bi bi-plus"},null,-1),Nt={class:"table mt-4 align-middle"},It=t("thead",{class:"table-primary"},[t("tr",{class:"my-2"},[t("th",null,"分類"),t("th",{width:"200"},"画像"),t("th",null,"商品名"),t("th",null,"原価"),t("th",null,"販売価格"),t("th",null,"使用状態"),t("th")])],-1),Rt=["src"],St={class:"form-check form-switch"},At=["checked","onChange"],Ft={class:"form-check-label",for:"flexSwitchCheckDefault"},Bt={key:0,class:"text-success"},Ot={key:1},jt={class:"text-end"},qt={class:"btn-group me-4"},zt=["onClick"],Gt=t("i",{class:"bi bi-pencil-fill mx-2"},null,-1),Ht=[Gt],Jt=["onClick"],Kt=t("i",{class:"bi bi-trash3-fill mx-2"},null,-1),Qt=[Kt];function Wt(l,e,a,$,s,i){const o=_("VLoading"),w=_("PaginationCard"),E=_("ProductsModal"),k=_("DelProductModal");return r(),u(M,null,[b(o,{active:s.isLoading},null,8,["active"]),t("div",Tt,[Ct,t("div",Lt,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=d=>i.openModal("new"))},[Dt,g(" 新規作成 ")])]),t("table",Nt,[It,t("tbody",null,[(r(!0),u(M,null,V(s.products,d=>(r(),u("tr",{key:d.id},[t("td",null,p(d.category),1),t("td",null,[t("img",{src:d.imageUrl,class:"card-img-top rounded-0",style:{"object-fit":"cover"},height:"120",alt:"..."},null,8,Rt)]),t("td",null,p(d.title),1),t("td",null,p(d.origin_price),1),t("td",null,p(d.price),1),t("td",null,[t("div",St,[t("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheckDefault",checked:d.is_enabled,onChange:y=>i.changeIsEnabled(d)},null,40,At),t("label",Ft,[d.is_enabled?(r(),u("span",Bt,"アクティベート")):(r(),u("span",Ot,"インアクティブ"))])])]),t("td",jt,[t("div",qt,[t("button",{type:"button",class:"btn btn-change btn-sm py-2",onClick:y=>i.openModal("edit",d)},Ht,8,zt),t("button",{type:"button",class:"btn btn-danger btn-sm py-2",onClick:y=>i.openModal("del",d)},Qt,8,Jt)])])]))),128))])]),b(w,{pages:s.pages,"get-products":i.getProducts},null,8,["pages","get-products"])]),b(E,{"temp-product":s.tempProduct,onUpdateProduct:i.updateProduct,"is-new":s.isNew,ref:"pModal"},null,8,["temp-product","onUpdateProduct","is-new"]),b(k,{"temp-product":s.tempProduct,onDeleteProduct:i.deleteProduct,ref:"dModal"},null,8,["temp-product","onDeleteProduct"])],64)}const ee=v(Vt,[["render",Wt]]);export{ee as default};
