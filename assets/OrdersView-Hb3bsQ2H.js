import{_ as v,o as l,b as a,d as t,t as o,s as C,j as E,u as L,F as f,k as $,f as y,m as g,r as u,e as p}from"./index-CgHBEOTy.js";import{s as O}from"./sweetAlertStore-w7mpYN6A.js";import{m as M}from"./modalMixin-oCo5jlFQ.js";import{P as T}from"./PaginationCard-WepPkMZT.js";const V={props:{tempOrder:{type:Object,default(){return{}}}},data(){return{modal:null,create_at:"",status:{},editOrder:{}}},methods:{switchDate(d){const e=new Date(d*1e3);let c=`${e.getFullYear()}-`,_=`${e.getMonth()+1<10?`0${e.getMonth()+1}`:e.getMonth()+1}-`,s=`${e.getDate()<10?`0${e.getDate()}`:e.getDate()} `,r=`${e.getHours()<10?`0${e.getHours()}`:e.getHours()}:`,n=e.getMinutes()<10?`0${e.getMinutes()}`:e.getMinutes();return c+_+s+r+n}},watch:{tempOrder(){this.editOrder=this.tempOrder,this.create_at=this.switchDate(this.tempOrder.create_at)}},emits:["update-paid"],mixins:[M]},P={class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},S={class:"modal-dialog modal-xl",role:"document"},N={class:"modal-content border-0"},I=t("div",{class:"modal-header bg-dark text-white"},[t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),U={class:"modal-body"},A={class:"row"},B={class:"col-md-4"},R=t("h3",null,"お客様情報",-1),j={class:"table mb-2"},F={key:0},H=t("th",null,"注文番号",-1),q=t("th",null,"注文日時",-1),Y=t("th",null,"お名前",-1),z=t("th",null,"携帯電話番号",-1),G=t("th",null,"メールアドレス",-1),J=t("th",null,"お届け先",-1),K=t("th",null,"備考欄",-1),Q=t("th",null,"お支払い状況",-1),W={key:0,class:"text-success"},X={key:1,class:"fw-bold text-danger"},Z={class:"form-check d-flex justify-content-end"},tt={class:"form-check-label",for:"flexCheckDefault"},et={key:0},st={key:1},dt={class:"col-md-8"},ot=t("h3",null,"注文内容",-1),lt={class:"table mb-2"},at=t("thead",null,[t("tr")],-1),nt={class:"text-end"},rt={class:"text-end"},it=t("span",{class:"text-danger fw-bold fs-3 me-4"},"合計",-1),ct={class:"text-danger fw-bold fs-4 me-2"},ht={class:"modal-footer"},_t=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," キャンセル ",-1);function ut(d,e,c,_,s,r){return l(),a("div",P,[t("div",S,[t("div",N,[I,t("div",U,[t("div",A,[t("div",B,[R,t("table",j,[s.editOrder.user?(l(),a("tbody",F,[t("tr",null,[H,t("td",null,o(s.editOrder.id),1)]),t("tr",null,[q,t("td",null,o(s.create_at),1)]),t("tr",null,[Y,t("td",null,o(s.editOrder.user.name),1)]),t("tr",null,[z,t("td",null,o(s.editOrder.user.tel),1)]),t("tr",null,[G,t("td",null,o(s.editOrder.user.email),1)]),t("tr",null,[J,t("td",null,o(s.editOrder.user.address),1)]),t("tr",null,[K,t("td",null,o(s.editOrder.message),1)]),t("tr",null,[Q,t("td",null,[s.editOrder.is_paid?(l(),a("strong",W,"お支払い済み")):(l(),a("span",X,"ご請求中"))])])])):C("",!0)]),t("div",Z,[E(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":e[0]||(e[0]=n=>s.editOrder.is_paid=n)},null,512),[[L,s.editOrder.is_paid]]),t("label",tt,[s.editOrder.is_paid?(l(),a("span",et,"已付款")):(l(),a("span",st,"未付款"))])])]),t("div",dt,[ot,t("table",lt,[at,t("tbody",null,[(l(!0),a(f,null,$(s.editOrder.products,n=>(l(),a("tr",{key:n.id},[t("th",null,o(n.product.title),1),t("td",null,o(n.qty)+" / "+o(n.product.unit),1),t("td",nt,o(Math.round(n.final_total)),1)]))),128))])]),t("div",rt,[it,t("span",ct,"¥ "+o(c.tempOrder.total),1)])])])]),t("div",ht,[_t,t("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=n=>d.$emit("update-paid",this.paid))}," 保存 ")])])])],512)}const pt=v(V,[["render",ut]]),mt={props:{tempOrder:{}},data(){return{modal:null}},emits:["delete-Order"],mixins:[M]},bt={id:"delOrderModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},ft={class:"modal-dialog"},gt={class:"modal-content border-0"},Ot=t("div",{class:"modal-header bg-danger text-white"},[t("h2",{id:"delOrderModalLabel",class:"modal-title fs-4"}," 注文削除 "),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),$t={class:"modal-body text-start"},yt={class:"text-danger"},vt={class:"modal-footer"},xt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," キャンセル ",-1);function Mt(d,e,c,_,s,r){return l(),a("div",bt,[t("div",ft,[t("div",gt,[Ot,t("div",$t,[y(" 注文 "),t("span",yt,o(c.tempOrder.id),1),y(" を削除しますか ")]),t("div",vt,[xt,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=n=>d.$emit("delete-order"))}," 削除 ")])])])],512)}const kt=v(mt,[["render",Mt]]);var wt={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_NAME:"eatburgertest",BASE_URL:"/EatBurger/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:m,VITE_NAME:b}=wt,Dt={data(){return{isLoading:!1,orders:[],pages:{},isNew:!1,tempOrder:{imagesUrl:[]}}},methods:{...g(O,["swalError"]),...g(O,["successToast"]),...g(O,["errorToast"]),getOrders(d=1){this.isLoading=!0,this.$http.get(`${m}/v2/api/${b}/admin/orders?page=${d}`).then(e=>{this.orders=e.data.orders,this.pages=e.data.pagination,this.isLoading=!1}).catch(()=>{this.swalError()})},openModal(d,e){d==="order"?(this.isNew=!1,this.tempOrder={...e},this.$refs.pModal.openModal()):d==="del"&&(this.tempOrder={...e},this.$refs.dModal.openModal())},updatePaid(){const d={is_paid:this.tempOrder.is_paid};this.$http.put(`${m}/v2/api/${b}/admin/order/${this.tempOrder.id}`,{data:d}).then(()=>{this.$refs.pModal.hideModal(),this.getOrders(),this.successToast("アップデートしました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},deleteOrder(){this.$http.delete(`${m}/v2/api/${b}/admin/order/${this.tempOrder.id}`,{data:this.tempOrder}).then(()=>{this.$refs.dModal.hideModal(),this.getOrders(),this.successToast("注文が削除されました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},switchDate(d){return new Date(d*1e3).toISOString().slice(0,10)},changeIspaid(d){this.tempOrder={...d},this.tempOrder.is_paid=!d.is_paid;const e={is_paid:this.tempOrder.is_paid};this.$http.put(`${m}/v2/api/${b}/admin/order/${this.tempOrder.id}`,{data:e}).then(()=>{this.getOrders(),this.successToast("お支払い状況が変更されました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})}},mounted(){this.getOrders()},components:{PaginationCard:T,OrderModal:pt,DelOrderModal:kt}},Ct={class:"container p-3"},Et=t("h2",{class:"mb-2"},"注文管理",-1),Lt={class:"table mt-4 align-middle"},Tt=t("thead",{class:"table-primary"},[t("tr",null,[t("th",null,"注文日時"),t("th",null,"メールアドレス"),t("th",null,"注文内容"),t("th",null,"合計"),t("th",null,"お支払い状況"),t("th")])],-1),Vt={class:"list-unstyled"},Pt={class:"fw-bold text-danger"},St={class:"form-check form-switch"},Nt=["checked","onChange"],It={class:"form-check-label",for:"flexSwitchCheckDefault"},Ut={key:0,class:"text-success"},At={key:1,class:"fw-bold text-danger"},Bt={class:"text-end"},Rt={class:"btn-group me-4"},jt=["onClick"],Ft=t("i",{class:"bi bi-search mx-2"},null,-1),Ht=[Ft],qt=["onClick"],Yt=t("i",{class:"bi bi-trash3-fill mx-2"},null,-1),zt=[Yt];function Gt(d,e,c,_,s,r){const n=u("VLoading"),x=u("PaginationCard"),k=u("OrderModal"),w=u("DelOrderModal");return l(),a(f,null,[p(n,{active:s.isLoading},null,8,["active"]),t("div",Ct,[Et,t("table",Lt,[Tt,t("tbody",null,[(l(!0),a(f,null,$(s.orders,i=>(l(),a("tr",{key:i.id},[t("td",null,o(r.switchDate(i.create_at)),1),t("td",null,o(i.user.email),1),t("td",null,[t("ul",Vt,[(l(!0),a(f,null,$(i.products,(h,D)=>(l(),a("li",{key:D},[t("span",Pt,o(h.qty)+" x",1),y(" "+o(h.product.title),1)]))),128))])]),t("td",null,o(i.total),1),t("td",null,[t("div",St,[t("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheckDefault",checked:i.is_paid,onChange:h=>r.changeIspaid(i)},null,40,Nt),t("label",It,[i.is_paid?(l(),a("span",Ut,"支払い済み")):(l(),a("span",At,"請求中"))])])]),t("td",Bt,[t("div",Rt,[t("button",{type:"button",class:"btn btn-change btn-sm py-2",onClick:h=>r.openModal("order",i)},Ht,8,jt),t("button",{type:"button",class:"btn btn-danger btn-sm py-2",onClick:h=>r.openModal("del",i)},zt,8,qt)])])]))),128))])]),p(x,{pages:s.pages,"get-orders":r.getOrders},null,8,["pages","get-orders"])]),p(k,{"temp-order":s.tempOrder,onUpdatePaid:r.updatePaid,switchdate:r.switchDate,ref:"pModal"},null,8,["temp-order","onUpdatePaid","switchdate"]),p(w,{"temp-order":s.tempOrder,onDeleteOrder:r.deleteOrder,ref:"dModal"},null,8,["temp-order","onDeleteOrder"])],64)}const Xt=v(Dt,[["render",Gt]]);export{Xt as default};
