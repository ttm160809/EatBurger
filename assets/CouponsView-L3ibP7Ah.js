import{_ as v,o as d,b as c,d as t,t as p,j as u,l as m,f as C,u as T,m as f,r as _,e as b,F as M,k as V,n as E}from"./index-CgHBEOTy.js";import{s as g}from"./sweetAlertStore-w7mpYN6A.js";import{m as y}from"./modalMixin-oCo5jlFQ.js";import{P as L}from"./PaginationCard-WepPkMZT.js";const N={props:{tempCoupon:{},updateCoupon:{},isNew:{}},data(){return{modal:null,editCoupon:{is_enabled:!1}}},methods:{switchDate(o){return new Date(o*1e3).toISOString().slice(0,10)}},watch:{tempCoupon(){this.editCoupon=this.tempCoupon}},emits:["update-coupon"],mixins:[y]},S={id:"couponModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},U={class:"modal-dialog modal-xl"},I={class:"modal-content border-0"},A={class:"modal-header bg-dark text-white"},B={id:"couponModalLabel",class:"modal-title fs-4"},P=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),R={class:"modal-body"},O={class:"row"},F={class:"row"},j={class:"mb-3 col-md-6"},z=t("label",{for:"title",class:"form-label"},"クーポン名",-1),q={class:"mb-3 col-md-6"},G=t("label",{for:"dueDate",class:"form-label"},"有効期限",-1),H={class:"row"},J={class:"mb-3 col-md-6"},K=t("label",{for:"code",class:"form-label"},"クーポンコード",-1),Q={class:"mb-3 col-md-6"},W={for:"percent",class:"form-label"},X={key:0,class:"text-danger fs-5 fw-bolder"},Y={key:1,class:"text-danger fs-5 fw-bolder"},Z=t("hr",null,null,-1),tt={class:"mb-3"},et={class:"form-check"},ot=t("label",{class:"form-check-label",for:"is_enabled"},"アクティベート",-1),st={class:"modal-footer"},nt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," キャンセル ",-1);function lt(o,e,a,$,s,i){return d(),c("div",S,[t("div",U,[t("div",I,[t("div",A,[t("h2",B,p(a.isNew?"新規作成":"クーポン編集"),1),P]),t("div",R,[t("div",O,[t("div",F,[t("div",j,[z,u(t("input",{id:"title",type:"text",class:"form-control",placeholder:"クーポン名","onUpdate:modelValue":e[0]||(e[0]=n=>s.editCoupon.title=n)},null,512),[[m,s.editCoupon.title]])]),t("div",q,[G,u(t("input",{id:"dueDate",type:"date",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=n=>s.editCoupon.due_date=n)},null,512),[[m,s.editCoupon.due_date]])])]),t("div",H,[t("div",J,[K,u(t("input",{id:"code",type:"text",class:"form-control",placeholder:"クーポンコード","onUpdate:modelValue":e[2]||(e[2]=n=>s.editCoupon.code=n)},null,512),[[m,s.editCoupon.code]])]),t("div",Q,[t("label",W,[C(" 割引 "),0<s.editCoupon.percent&&s.editCoupon.percent<=100?(d(),c("span",X," ("+p(100-s.editCoupon.percent)+"%引) ",1)):(d(),c("span",Y," (0%引) "))]),u(t("input",{id:"percent",type:"text",class:"form-control",placeholder:"割引","onUpdate:modelValue":e[3]||(e[3]=n=>s.editCoupon.percent=n)},null,512),[[m,s.editCoupon.percent]])])]),Z,t("div",tt,[t("div",et,[u(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=n=>s.editCoupon.is_enabled=n)},null,512),[[T,s.editCoupon.is_enabled]]),ot])])])]),t("div",st,[nt,t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=n=>o.$emit("update-coupon",o.editcoupon))},p(a.isNew?"作成":"保存"),1)])])])],512)}const at=v(N,[["render",lt]]),it={props:{tempCoupon:{}},data(){return{modal:null}},emits:["delete-Coupon"],mixins:[y]},dt={id:"delCouponModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delCouponModalLabel","aria-hidden":"true"},ct={class:"modal-dialog"},pt={class:"modal-content border-0"},ut=t("div",{class:"modal-header bg-danger text-white"},[t("h2",{id:"delCouponModalLabel",class:"modal-title fs-4"}," クーポン削除 "),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),rt={class:"modal-body text-start"},ht={class:"text-danger"},mt={class:"modal-footer"},_t=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," キャンセル ",-1);function bt(o,e,a,$,s,i){return d(),c("div",dt,[t("div",ct,[t("div",pt,[ut,t("div",rt,[C(" クーポン "),t("span",ht,p(a.tempCoupon.title),1),C(" を削除しますか ")]),t("div",mt,[_t,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=n=>o.$emit("delete-coupon"))}," 削除 ")])])])],512)}const Ct=v(it,[["render",bt]]);var ft={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_NAME:"eatburgertest",BASE_URL:"/EatBurger/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:r,VITE_NAME:h}=ft,gt={data(){return{isLoading:!1,coupons:[],pages:{},isNew:!1,tempCoupon:{},timestamp:""}},methods:{...f(g,["swalError"]),...f(g,["successToast"]),...f(g,["errorToast"]),getCoupons(){this.isLoading=!0,this.$http.get(`${r}/v2/api/${h}/admin/coupons`).then(o=>{this.coupons=o.data.coupons,this.pages=o.data.pagination,this.timestamp=Math.floor(new Date().getTime()/1e3),this.isLoading=!1}).catch(()=>{this.swalError()})},openModal(o,e){o==="new"?(this.isNew=!0,this.tempCoupon={is_enabled:0},this.$refs.cModal.openModal()):o==="edit"?(this.isNew=!1,this.tempCoupon={...e},this.tempCoupon.due_date=this.switchDate(this.tempCoupon.due_date),this.$refs.cModal.openModal()):o==="del"&&(this.tempCoupon={...e},this.$refs.dModal.openModal())},updateCoupon(){let o="post",e="クポーンデータが作成されました",a=`${r}/v2/api/${h}/admin/coupon`;if(this.isNew===!1&&(o="put",e="アップデートしました",a=`${r}/v2/api/${h}/admin/coupon/${this.tempCoupon.id}`),this.tempCoupon.percent<=0||this.tempCoupon.percent>=101){this.errorToast("1~100までの整数値を入力してください");return}this.tempCoupon.percent=Number(this.tempCoupon.percent),this.tempCoupon.due_date=new Date(this.tempCoupon.due_date).getTime()/1e3,this.$http[o](a,{data:this.tempCoupon}).then(()=>{this.$refs.cModal.hideModal(),this.getCoupons(),this.successToast(e)}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},deleteCoupon(){this.$http.delete(`${r}/v2/api/${h}/admin/Coupon/${this.tempCoupon.id}`,{data:this.tempCoupon}).then(()=>{this.$refs.dModal.hideModal(),this.getCoupons(),this.successToast("クポーンが削除されました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},changeIsEnabled(o){this.tempCoupon={...o},this.tempCoupon.is_enabled=Math.abs(o.is_enabled-1),this.$http.put(`${r}/v2/api/${h}/admin/coupon/${this.tempCoupon.id}`,{data:this.tempCoupon}).then(()=>{this.getCoupons(),this.tempCoupon.is_enabled===1?this.successToast("クポーンがアクティベートされました"):this.successToast("クポーンがインアクティブされました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},switchDate(o){return new Date(o*1e3).toISOString().slice(0,10)}},mounted(){this.getCoupons()},components:{PaginationCard:L,CouponModal:at,DelCouponModal:Ct}},vt={class:"container p-3"},$t=t("h2",{class:"mb-2"},"クーポン管理",-1),wt={class:"text-end mt-4"},Mt=t("i",{class:"bi bi-plus"},null,-1),yt={class:"table mt-4 align-middle"},xt=t("thead",{class:"table-primary"},[t("tr",{class:"my-2"},[t("th",null,"クーポン名"),t("th",null,"クーポンコード"),t("th",null,"割引"),t("th",null,"有効期限"),t("th",null,"使用状態"),t("th")])],-1),kt={class:"form-check form-switch"},Dt=["checked","onChange"],Tt={class:"form-check-label",for:"flexSwitchCheckDefault"},Vt={key:0,class:"text-success"},Et={key:1},Lt={class:"text-end"},Nt={class:"btn-group me-4"},St=["onClick"],Ut=t("i",{class:"bi bi-pencil-fill mx-2"},null,-1),It=[Ut],At=["onClick"],Bt=t("i",{class:"bi bi-trash3-fill mx-2"},null,-1),Pt=[Bt];function Rt(o,e,a,$,s,i){const n=_("VLoading"),x=_("PaginationCard"),k=_("CouponModal"),D=_("DelCouponModal");return d(),c(M,null,[b(n,{active:s.isLoading},null,8,["active"]),t("div",vt,[$t,t("div",wt,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=l=>i.openModal("new"))},[Mt,C(" 新規作成 ")])]),t("table",yt,[xt,t("tbody",null,[(d(!0),c(M,null,V(s.coupons,l=>(d(),c("tr",{key:l.id},[t("td",null,p(l.title),1),t("td",null,p(l.code),1),t("td",null,p(100-l.percent)+" %引",1),t("td",{class:E({"text-danger":l.due_date<=this.timestamp,"fw-bold":l.due_date<=this.timestamp})},p(i.switchDate(l.due_date)),3),t("td",null,[t("div",kt,[t("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheckDefault",checked:l.is_enabled,onChange:w=>i.changeIsEnabled(l)},null,40,Dt),t("label",Tt,[l.is_enabled?(d(),c("span",Vt,"アクティベート")):(d(),c("span",Et,"インアクティブ"))])])]),t("td",Lt,[t("div",Nt,[t("button",{type:"button",class:"btn btn-change btn-sm py-2",onClick:w=>i.openModal("edit",l)},It,8,St),t("button",{type:"button",class:"btn btn-danger btn-sm py-2",onClick:w=>i.openModal("del",l)},Pt,8,At)])])]))),128))])]),b(x,{pages:s.pages,"get-coupons":i.getCoupons},null,8,["pages","get-coupons"])]),b(k,{"temp-coupon":s.tempCoupon,onUpdateCoupon:i.updateCoupon,"is-new":s.isNew,ref:"cModal"},null,8,["temp-coupon","onUpdateCoupon","is-new"]),b(D,{"temp-coupon":s.tempCoupon,onDeleteCoupon:i.deleteCoupon,ref:"dModal"},null,8,["temp-coupon","onDeleteCoupon"])],64)}const qt=v(gt,[["render",Rt]]);export{qt as default};
